# yaml-language-server: $schema=https://schema.zeabur.app/template.json
apiVersion: zeabur.com/v1
kind: Template
metadata:
  name: Kong Gateway OSS (DB-less Mode)
spec:
  description: A lightweight, high-performance API Gateway running in DB-less mode with declarative configuration
  icon: https://docs.konghq.com/assets/images/favicon.ico
  coverImage: https://camo.githubusercontent.com/733593a5edce1e6474a3a82297582a813bbee7ba2edee6db8b35aa8c744a1e83/68747470733a2f2f6b6f6e6768712e636f6d2f77702d636f6e74656e742f75706c6f6164732f323031382f30352f6b6f6e672d6c6f676f2d6769746875622d726561646d652e706e67
  tags:
    - API Gateway
    - DB-less
    - Reverse Proxy
    - Microservices
    - Cloud Native
  variables:
    - key: KONG_PUBLIC_DOMAIN
      type: DOMAIN
      name: Kong Proxy Domain
      description: The domain to bind to Kong Proxy (port 8000)
  readme: |-
    # Kong Gateway OSS (DB-less Mode)
    
    Kong Gateway is a lightweight, high-performance API Gateway that can be deployed without a database. 
    This template uses declarative configuration for all routes, services, and plugins.
    
    ## Features
    - ğŸš€ **One-Click Deployment** on Zeabur
    - ğŸ”„ **Stateless Mode** with declarative configuration
    - ğŸ”Œ **Pre-configured** with a sample httpbin service
    - ğŸŒ **Custom Domain** support
    - ğŸ“Š **Kong Manager** included
    
    ## Documentation
    - [Kong DB-less Mode](https://docs.konghq.com/gateway/latest/production/deployment-topologies/db-less-and-declarative-config/)
    - [Declarative Configuration](https://docs.konghq.com/gateway/latest/reference/configuration/)
  services:
    - name: Kong Gateway
      icon: https://docs.konghq.com/assets/images/favicon.ico
      template: PREBUILT
      domainKey: KONG_PUBLIC_DOMAIN
      spec:
        source:
          image: kong/kong-gateway:3.10.0.1
        ports:
          - id: proxy
            port: 8000
            type: HTTP
          - id: manager
            port: 8002
            type: HTTP
          - id: admin
            port: 8001
            type: HTTP
        env:
          # DB-less mode configuration
          KONG_DATABASE: 
            default: "off"
          KONG_DECLARATIVE_CONFIG: 
            default: "/kong/declarative/kong.yml"
          KONG_NGINX_WORKER_PROCESSES: 
            default: "1"
          
          # Admin API configuration
          KONG_ADMIN_LISTEN: 
            default: "0.0.0.0:8001"
          KONG_ADMIN_ACCESS_LOG: 
            default: /dev/stdout
          KONG_ADMIN_ERROR_LOG: 
            default: /dev/stderr
          
          # Proxy configuration
          KONG_PROXY_ACCESS_LOG: 
            default: /dev/stdout
          KONG_PROXY_ERROR_LOG: 
            default: /dev/stderr
          
          # Security headers
          KONG_HEADERS: 
            default: "off"
          KONG_HEADERS_ACCESS_CONTROL_ALLOW_ORIGIN: 
            default: "*"
          
          # Performance tuning for DB-less
          KONG_LUA_PACKAGE_PATH: 
            default: "/opt/kong/?.lua;/opt/kong/?/init.lua;"
          
          # Health check endpoint
          KONG_STATUS_LISTEN: 
            default: "0.0.0.0:8100"
          
        healthcheck:
          test: ["CMD", "kong", "health"]
          interval: 30s
          timeout: 10s
          retries: 3
          start_period: 30s
          
        volumes:
          - id: config
            dir: /kong/declarative
            
        configs:
          - path: /kong/declarative/kong.yml
            template: |-
              _format_version: "3.0"
              _transform: true
              
              # Example API service
              services:
                - name: status
                  url: http://localhost:8100/status
                  routes:
                    - name: status-route
                      paths: [ "/status" ]
                      strip_path: false

                - name: httpbin
                  url: https://httpbin.org
                  routes:
                    - name: httpbin-route
                      paths: [ "/httpbin" ]
                      strip_path: true
                      methods: ["GET", "POST", "PUT", "DELETE", "PATCH", "OPTIONS"]
                      preserve_host: false
                      protocols: ["http", "https"]
              
            envsubst: true

localization:
  "zh-TW":
    description: è¼•é‡ç´šã€é«˜æ•ˆèƒ½çš„ API é–˜é“ï¼Œæ¡ç”¨ç„¡è³‡æ–™åº«æ¨¡å¼é‹è¡Œï¼Œä½¿ç”¨å®£å‘Šå¼é…ç½®
    variables:
      - key: KONG_PUBLIC_DOMAIN
        name: Kong Proxy ç¶²åŸŸ
        description: è«‹è¼¸å…¥ä½ è¦ç¶å®šåˆ° Kong Proxy (8000) çš„ç¶²åŸŸ
        type: DOMAIN
    readme: |-
      # Kong Gateway OSS (ç„¡è³‡æ–™åº«æ¨¡å¼)
      
      Kong Gateway æ˜¯ä¸€å€‹è¼•é‡ç´šã€é«˜æ•ˆèƒ½çš„ API é–˜é“ï¼Œå¯ä»¥åœ¨ç„¡è³‡æ–™åº«æ¨¡å¼ä¸‹é‹è¡Œã€‚
      æ­¤æ¨¡æ¿ä½¿ç”¨å®£å‘Šå¼é…ç½®ä¾†ç®¡ç†æ‰€æœ‰è·¯ç”±ã€æœå‹™å’Œå¤–æ›ã€‚
      
      ## åŠŸèƒ½ç‰¹é»
      - ğŸš€ **ä¸€éµéƒ¨ç½²** åœ¨ Zeabur ä¸Š
      - ğŸ”„ **ç„¡ç‹€æ…‹æ¨¡å¼** ä½¿ç”¨å®£å‘Šå¼é…ç½®
      - ğŸ”Œ **é å…ˆé…ç½®** åŒ…å« httpbin ç¯„ä¾‹æœå‹™
      - ğŸŒ **è‡ªè¨‚ç¶²åŸŸ** æ”¯æ´
      - ğŸ“Š **Kong Manager** ç®¡ç†ä»‹é¢
    
      ## å»ºè­°æ­é…ä½¿ç”¨
      - Cloudflare Access ä½œç‚ºç™»å…¥ä¿è­·å±¤
      - é…ç½® Admin API åƒ…å…§éƒ¨ä½¿ç”¨ï¼ˆæœªé–‹æ”¾ `8001`ï¼‰
    
      ## æ–‡ä»¶
      - [Kong ç„¡è³‡æ–™åº«æ¨¡å¼](https://docs.konghq.com/gateway/latest/production/deployment-topologies/db-less-and-declarative-config/)
      - [å®£å‘Šå¼é…ç½®](https://docs.konghq.com/gateway/latest/reference/configuration/)
